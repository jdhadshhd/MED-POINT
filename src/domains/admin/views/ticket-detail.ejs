<!-- Admin Ticket Detail -->
<div class="page-header">
  <h1 class="page-title">Ticket: <%= ticket.title %></h1>
  <a href="/admin/support" class="btn btn-outline">Back to Tickets</a>
</div>

<div class="ticket-grid">
  <div class="ticket-main">
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">Ticket Details</h2>
        <div>
          <span class="badge badge-<%= ticket.priority.toLowerCase() %>"><%= ticket.priority %></span>
          <span class="badge badge-<%= ticket.status.toLowerCase() %>"><%= ticket.status %></span>
        </div>
      </div>
      
      <div class="ticket-info">
        <p><strong>From:</strong> <%= ticket.user.name %> (<%= ticket.user.email %>)</p>
        <p><strong>Created:</strong> <%= new Date(ticket.createdAt).toLocaleString() %></p>
      </div>
      
      <div class="ticket-description">
        <h4>Description</h4>
        <p><%= ticket.description %></p>
      </div>
    </div>
    
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">Messages</h2>
      </div>
      
      <div class="messages-list">
        <% if (ticket.messages.length === 0) { %>
        <p class="no-messages">No messages yet.</p>
        <% } else { %>
        <% ticket.messages.forEach(function(msg) { %>
        <div class="message <%= msg.sender.role === 'ADMIN' ? 'message-admin' : 'message-user' %>">
          <div class="message-header">
            <strong><%= msg.sender.name %></strong>
            <span class="badge badge-<%= msg.sender.role.toLowerCase() %>"><%= msg.sender.role %></span>
            <span class="message-time"><%= new Date(msg.createdAt).toLocaleString() %></span>
          </div>
          <p class="message-content"><%= msg.message %></p>
        </div>
        <% }); %>
        <% } %>
      </div>
      
      <% if (ticket.status !== 'CLOSED') { %>
      <form action="/admin/support/<%= ticket.id %>/reply" method="POST" class="reply-form">
        <div class="form-group">
          <label for="message">Reply</label>
          <textarea id="message" name="message" class="form-control" rows="3" 
                    placeholder="Type your reply..." required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Send Reply</button>
      </form>
      <% } %>
    </div>
  </div>
  
  <div class="ticket-sidebar">
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">Actions</h2>
      </div>
      
      <form action="/admin/support/<%= ticket.id %>/status" method="POST">
        <div class="form-group">
          <label for="status">Update Status</label>
          <select id="status" name="status" class="form-control">
            <option value="OPEN" <%= ticket.status === 'OPEN' ? 'selected' : '' %>>Open</option>
            <option value="IN_PROGRESS" <%= ticket.status === 'IN_PROGRESS' ? 'selected' : '' %>>In Progress</option>
            <option value="RESOLVED" <%= ticket.status === 'RESOLVED' ? 'selected' : '' %>>Resolved</option>
            <option value="CLOSED" <%= ticket.status === 'CLOSED' ? 'selected' : '' %>>Closed</option>
          </select>
        </div>
        <button type="submit" class="btn btn-primary btn-full">Update Status</button>
      </form>
    </div>
  </div>
</div>

<style>
.ticket-grid {
  display: grid;
  grid-template-columns: 1fr 300px;
  gap: 1.5rem;
}

.ticket-info {
  padding: 1rem 0;
  border-bottom: 1px solid #eee;
}

.ticket-info p {
  margin: 0.25rem 0;
}

.ticket-description {
  padding-top: 1rem;
}

.ticket-description h4 {
  margin-bottom: 0.5rem;
}

.messages-list {
  max-height: 400px;
  overflow-y: auto;
  padding: 1rem 0;
}

.no-messages {
  color: #666;
  text-align: center;
  padding: 2rem;
}

.message {
  padding: 1rem;
  margin-bottom: 1rem;
  border-radius: 8px;
  background: #f8f9fa;
}

.message-admin {
  background: #e8f0fe;
}

.message-header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.message-time {
  font-size: 0.85rem;
  color: #666;
  margin-left: auto;
}

.message-content {
  margin: 0;
}

.reply-form {
  padding-top: 1rem;
  border-top: 1px solid #eee;
}

@media (max-width: 768px) {
  .ticket-grid {
    grid-template-columns: 1fr;
  }
}
</style>
