<!-- Patient Upload Page -->
<div class="page-header">
  <div class="page-title">
    <h2><i class="fas fa-cloud-upload-alt"></i> Upload Files</h2>
    <p>Upload medical documents and images</p>
  </div>
</div>

<div class="upload-grid">
  <div class="dashboard-card">
    <div class="card-header">
      <div class="card-title">
        <h3><i class="fas fa-file-upload"></i> Upload Medical File</h3>
        <p>Attach files to your medical records</p>
      </div>
    </div>
    
    <% if (records.length === 0) { %>
    <div class="alert alert-info" style="margin-top: 20px;">
      <i class="fas fa-info-circle"></i>
      No existing medical records. A new record will be created automatically when you upload a file.
    </div>
    <% } %>
    <form action="/patient/upload" method="POST" enctype="multipart/form-data" style="padding: 20px 0;">
      <% if (records.length > 0) { %>
      <div class="form-group">
        <label for="recordId"><i class="fas fa-file-medical"></i> Attach to Record (Optional)</label>
        <select id="recordId" name="recordId" class="form-control">
          <option value="">Create new record automatically</option>
          <% records.forEach(function(record) { %>
          <option value="<%= record.id %>">
            <%= new Date(record.createdAt).toLocaleDateString() %> - 
            Dr. <%= record.doctor.name %>
          </option>
          <% }); %>
        </select>
      </div>
      <% } %>
      
      <div class="form-group">
        <label for="notes"><i class="fas fa-sticky-note"></i> Description (Optional)</label>
        <input type="text" id="notes" name="notes" class="form-control" 
               placeholder="e.g., Blood test results, X-ray image...">
      </div>
      
      <div class="form-group">
        <label><i class="fas fa-paperclip"></i> Choose File</label>
        <div class="upload-area" onclick="document.getElementById('file').click();">
          <i class="fas fa-cloud-upload-alt"></i>
          <p>Click to select a file</p>
          <p class="upload-hint">Supported: JPEG, PNG, GIF, PDF (max 10MB)</p>
        </div>
        <input type="file" id="file" name="file" required 
               accept=".jpg,.jpeg,.png,.gif,.pdf"
               style="display: none;"
               onchange="updateFileName(this)">
        <p id="selectedFileName" class="selected-file"></p>
      </div>
      
      <button type="submit" class="btn btn-primary" style="width: 100%;">
        <i class="fas fa-upload"></i> Upload File
      </button>
    </form>
  </div>
  
  <div class="dashboard-card">
    <div class="card-header">
      <div class="card-title">
        <h3><i class="fas fa-folder-open"></i> Uploaded Files</h3>
        <p>Your attached documents</p>
      </div>
    </div>
    
    <% if (files.length === 0) { %>
    <div class="empty-state" style="text-align: center; padding: 60px;">
      <i class="fas fa-folder" style="font-size: 64px; color: #ccc; margin-bottom: 20px;"></i>
      <h3 style="color: var(--Paraghfont); margin-bottom: 10px;">No Files Uploaded</h3>
      <p style="color: #888;">Your uploaded files will appear here.</p>
    </div>
    <% } else { %>
    <ul class="files-list">
      <% files.forEach(function(file) { %>
      <li class="file-item">
        <div class="file-icon <%= file.mimeType.includes('pdf') ? 'pdf' : file.mimeType.includes('image') ? 'image' : '' %>">
          <% if (file.mimeType.includes('pdf')) { %>
          <i class="fas fa-file-pdf"></i>
          <% } else if (file.mimeType.includes('image')) { %>
          <i class="fas fa-file-image"></i>
          <% } else { %>
          <i class="fas fa-file-alt"></i>
          <% } %>
        </div>
        <div class="file-info">
          <a href="/uploads/<%= file.filePath %>" target="_blank"><%= file.originalName %></a>
          <span class="file-meta">
            <i class="fas fa-weight"></i> <%= (file.size / 1024).toFixed(1) %> KB â€¢ 
            <i class="fas fa-calendar"></i> <%= new Date(file.uploadedAt).toLocaleDateString() %>
          </span>
        </div>
      </li>
      <% }); %>
    </ul>
    <% } %>
  </div>
</div>

<script>
function updateFileName(input) {
  const fileName = input.files[0]?.name || '';
  document.getElementById('selectedFileName').textContent = fileName 
    ? 'Selected: ' + fileName 
    : '';
}
</script>

<style>
.upload-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 25px;
}

.form-group label i {
  margin-right: 8px;
  color: var(--spanfonts);
}

.upload-area {
  border: 2px dashed #ddd;
  border-radius: 12px;
  padding: 40px;
  text-align: center;
  cursor: pointer;
  transition: var(--transition);
  background: #f8f9fa;
}

.upload-area:hover {
  border-color: var(--spanfonts);
  background: rgba(44, 165, 141, 0.05);
}

.upload-area i {
  font-size: 48px;
  color: var(--spanfonts);
  margin-bottom: 15px;
}

.upload-area p {
  margin: 5px 0;
  color: var(--Paraghfont);
}

.upload-hint {
  font-size: 13px;
  color: #888 !important;
}

.selected-file {
  margin-top: 10px;
  color: var(--spanfonts);
  font-weight: 500;
}

.alert-warning {
  background: rgba(255, 193, 7, 0.1);
  border: 1px solid rgba(255, 193, 7, 0.3);
  color: #856404;
  padding: 15px 20px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  gap: 12px;
}

.alert-warning i {
  font-size: 20px;
}

.files-list {
  list-style: none;
  margin: 20px 0 0 0;
  padding: 0;
}

.file-item {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 15px;
  background: #f8f9fa;
  border-radius: 10px;
  margin-bottom: 10px;
  transition: var(--transition);
}

.file-item:hover {
  box-shadow: var(--shadow);
}

.file-item:last-child {
  margin-bottom: 0;
}

.file-icon {
  width: 45px;
  height: 45px;
  background: linear-gradient(135deg, var(--navcolor), var(--spanfonts));
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.file-icon i {
  font-size: 20px;
  color: white;
}

.file-icon.pdf {
  background: linear-gradient(135deg, #dc3545, #ff6b6b);
}

.file-icon.image {
  background: linear-gradient(135deg, #6f42c1, #9f7aea);
}

.file-info {
  flex: 1;
}

.file-info a {
  display: block;
  font-weight: 500;
  color: var(--Paraghfont);
  text-decoration: none;
  margin-bottom: 5px;
}

.file-info a:hover {
  color: var(--navcolor);
}

.file-meta {
  font-size: 13px;
  color: #888;
}

.file-meta i {
  margin-right: 5px;
}

@media (max-width: 768px) {
  .upload-grid {
    grid-template-columns: 1fr;
  }
}
</style>
